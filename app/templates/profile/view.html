{% extends "base.html" %}

{% block title %}{{ user.username }} - eID{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h1>@{{ user.username }}</h1>
            {% if is_own_profile %}
                <a href="{{ url_for('profile.edit') }}" class="btn btn-secondary">‚úèÔ∏è Editar perfil</a>
            {% endif %}
        </div>
        
        {% if user.full_name %}
            <h2 style="color: var(--gray); font-size: 1.3rem; margin-bottom: 1rem;">{{ user.full_name }}</h2>
        {% endif %}
        
        {% if user.bio %}
            <p style="margin: 1.5rem 0; color: var(--dark);">{{ user.bio }}</p>
        {% else %}
            {% if is_own_profile %}
                <p style="color: var(--gray); font-style: italic; margin: 1rem 0;">
                    üìù No has a√±adido una biograf√≠a a√∫n. 
                    <a href="{{ url_for('profile.edit') }}">A√±ade una aqu√≠</a>
                </p>
            {% endif %}
        {% endif %}
        
        {% if user.website %}
            <p style="margin: 1rem 0;">üåê <a href="{{ user.website }}" target="_blank" style="color: var(--primary);">{{ user.website }}</a></p>
        {% endif %}
        
        {% if is_own_profile %}
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--light);">
                <h3 style="color: var(--dark); margin-bottom: 1rem;">üîê Tu C√≥digo de Amigo</h3>
                <div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 1.5rem; border-radius: 10px; color: white;">
                    <div style="font-size: 1.8rem; font-weight: bold; letter-spacing: 0.3rem; text-align: center; font-family: 'Courier New', monospace; margin-bottom: 1rem;">
                        {{ user.friend_code }}
                    </div>
                    <button onclick="copyCode()" class="btn" style="background: white; color: var(--primary); width: 100%;">
                        üìã Copiar c√≥digo
                    </button>
                </div>
                <p style="color: var(--gray); font-size: 0.9rem; margin-top: 1rem; text-align: center;">
                    Comparte este c√≥digo con tus amigos para que puedan agregarte
                </p>
            </div>
        {% endif %}
    </div>
    
    <div class="card">
        <h2 style="margin-bottom: 1.5rem;">üì± Redes Sociales</h2>
        
        {% if is_own_profile %}
            <div class="social-tabs-container">
                <div class="contact-tabs">
                    <button class="tab-btn active" data-platform="whatsapp" onclick="switchTab('whatsapp')">üì± WhatsApp</button>
                    <button class="tab-btn" data-platform="facebook" onclick="switchTab('facebook')">üìò Facebook</button>
                    <button class="tab-btn" data-platform="instagram" onclick="switchTab('instagram')">üì∑ Instagram</button>
                    <button class="tab-btn" data-platform="linkedin" onclick="switchTab('linkedin')">üíº LinkedIn</button>
                    <button class="tab-btn" data-platform="x" onclick="switchTab('x')">‚úñÔ∏è X</button>
                    <button class="tab-btn" data-platform="tiktok" onclick="switchTab('tiktok')">üéµ TikTok</button>
                    <button class="tab-btn" data-platform="youtube" onclick="switchTab('youtube')">üì∫ YouTube</button>
                </div>
                
                <div class="tab-contents">
                    <!-- WhatsApp -->
                    <div class="tab-content active" id="tab-whatsapp">
                        <h3>üì± WhatsApp</h3>
                        
                        {% if links_dict.get('WhatsApp') and links_dict.get('WhatsApp').get('profile_data_parsed') %}
                            {% set wa_data = links_dict.get('WhatsApp').get('profile_data_parsed') %}
                            <div class="social-preview">
                                <div class="preview-header">
                                    <div class="preview-avatar-placeholder">üì±</div>
                                    <div class="preview-info">
                                        <h4>{{ wa_data.get('profile_name') or 'WhatsApp' }}</h4>
                                        <p class="preview-username">{{ links_dict.get('WhatsApp').get('username', '') }}</p>
                                    </div>
                                </div>
                                <a href="{{ links_dict.get('WhatsApp').get('url') }}" target="_blank" class="preview-link">Abrir chat ‚Üí</a>
                            </div>
                            <hr style="margin: 2rem 0;">
                        {% endif %}
                        
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="WhatsApp">
                            <div class="form-group">
                                <label for="whatsapp-url">URL de WhatsApp *</label>
                                <input type="url" id="whatsapp-url" name="url" class="form-control" 
                                       placeholder="https://wa.me/34600000000" value="{{ links_dict.get('WhatsApp', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega tu enlace de WhatsApp (ej: https://wa.me/34600000000)</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('WhatsApp', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar WhatsApp</button>
                        </form>
                    </div>
                    
                    <!-- Facebook -->
                    <div class="tab-content" id="tab-facebook">
                        <h3>üìò Facebook</h3>
                        
                        {% if links_dict.get('Facebook') and links_dict.get('Facebook').get('profile_data_parsed') %}
                            <!-- Preview de informaci√≥n extra√≠da -->
                            {% set fb_data = links_dict.get('Facebook').get('profile_data_parsed') %}
                            <div class="social-preview">
                                <div class="preview-header">
                                    {% if fb_data.get('avatar') %}
                                        <img src="{{ fb_data.avatar }}" alt="Avatar" class="preview-avatar">
                                    {% else %}
                                        <div class="preview-avatar-placeholder">üìò</div>
                                    {% endif %}
                                    <div class="preview-info">
                                        <h4>{{ fb_data.get('profile_name') or links_dict.get('Facebook').get('username') or 'Tu perfil de Facebook' }}</h4>
                                        <p class="preview-username">{{ links_dict.get('Facebook').get('username', '') }}</p>
                                    </div>
                                </div>
                                {% if fb_data.get('bio') %}
                                    <p class="preview-bio">{{ fb_data.bio[:150] }}{% if fb_data.bio|length > 150 %}...{% endif %}</p>
                                {% endif %}
                                <a href="{{ links_dict.get('Facebook').get('url') }}" target="_blank" class="preview-link">Ver perfil completo ‚Üí</a>
                            </div>
                            <hr style="margin: 2rem 0;">
                        {% endif %}
                        
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="Facebook">
                            <div class="form-group">
                                <label for="facebook-url">URL de tu perfil *</label>
                                <input type="url" id="facebook-url" name="url" class="form-control" 
                                       placeholder="https://facebook.com/tunombre" value="{{ links_dict.get('Facebook', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega el enlace a tu perfil de Facebook</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('Facebook', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar Facebook</button>
                        </form>
                    </div>
                    
                    <!-- Instagram -->
                    <div class="tab-content" id="tab-instagram">
                        <h3>üì∑ Instagram</h3>
                        
                        {% if links_dict.get('Instagram') and links_dict.get('Instagram').get('profile_data_parsed') %}
                            {% set ig_data = links_dict.get('Instagram').get('profile_data_parsed') %}
                            <div class="social-preview">
                                <div class="preview-header">
                                    {% if ig_data.get('avatar') %}
                                        <img src="{{ ig_data.avatar }}" alt="Avatar" class="preview-avatar">
                                    {% else %}
                                        <div class="preview-avatar-placeholder">üì∑</div>
                                    {% endif %}
                                    <div class="preview-info">
                                        <h4>{{ ig_data.get('profile_name') or links_dict.get('Instagram').get('username') or 'Tu perfil de Instagram' }}</h4>
                                        <p class="preview-username">{{ links_dict.get('Instagram').get('username', '') }}</p>
                                    </div>
                                </div>
                                {% if ig_data.get('bio') %}
                                    <p class="preview-bio">{{ ig_data.bio[:150] }}{% if ig_data.bio|length > 150 %}...{% endif %}</p>
                                {% endif %}
                                <a href="{{ links_dict.get('Instagram').get('url') }}" target="_blank" class="preview-link">Ver perfil completo ‚Üí</a>
                            </div>
                            <hr style="margin: 2rem 0;">
                        {% endif %}
                        
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="Instagram">
                            <div class="form-group">
                                <label for="instagram-url">URL de tu perfil *</label>
                                <input type="url" id="instagram-url" name="url" class="form-control" 
                                       placeholder="https://instagram.com/tunombre" value="{{ links_dict.get('Instagram', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega el enlace a tu perfil de Instagram</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('Instagram', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar Instagram</button>
                        </form>
                    </div>
                    
                    <!-- LinkedIn -->
                    <div class="tab-content" id="tab-linkedin">
                        <h3>üíº LinkedIn</h3>
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="LinkedIn">
                            <div class="form-group">
                                <label for="linkedin-url">URL de tu perfil *</label>
                                <input type="url" id="linkedin-url" name="url" class="form-control" 
                                       placeholder="https://linkedin.com/in/tunombre" value="{{ links_dict.get('LinkedIn', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega el enlace a tu perfil de LinkedIn</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('LinkedIn', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar LinkedIn</button>
                        </form>
                    </div>
                    
                    <!-- X (Twitter) -->
                    <div class="tab-content" id="tab-x">
                        <h3>‚úñÔ∏è X (Twitter)</h3>
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="X">
                            <div class="form-group">
                                <label for="x-url">URL de tu perfil *</label>
                                <input type="url" id="x-url" name="url" class="form-control" 
                                       placeholder="https://x.com/tunombre" value="{{ links_dict.get('X', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega el enlace a tu perfil de X (Twitter)</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('X', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar X</button>
                        </form>
                    </div>
                    
                    <!-- TikTok -->
                    <div class="tab-content" id="tab-tiktok">
                        <h3>üéµ TikTok</h3>
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="TikTok">
                            <div class="form-group">
                                <label for="tiktok-url">URL de tu perfil *</label>
                                <input type="url" id="tiktok-url" name="url" class="form-control" 
                                       placeholder="https://tiktok.com/@tunombre" value="{{ links_dict.get('TikTok', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega el enlace a tu perfil de TikTok</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('TikTok', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar TikTok</button>
                        </form>
                    </div>
                    
                    <!-- YouTube -->
                    <div class="tab-content" id="tab-youtube">
                        <h3>üì∫ YouTube</h3>
                        <form method="POST" action="{{ url_for('profile.save_social_link') }}">
                            <input type="hidden" name="platform" value="YouTube">
                            <div class="form-group">
                                <label for="youtube-url">URL de tu canal *</label>
                                <input type="url" id="youtube-url" name="url" class="form-control" 
                                       placeholder="https://youtube.com/@tucanal" value="{{ links_dict.get('YouTube', {}).get('url', '') }}" required>
                                <small style="color: var(--gray);">Pega el enlace a tu canal de YouTube</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="is_visible" value="1" {{ 'checked' if links_dict.get('YouTube', {}).get('is_visible', True) else '' }}>
                                    Mostrar en mi perfil
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">üíæ Guardar YouTube</button>
                        </form>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- Vista para contactos -->
            {% if social_links %}
                <div class="grid grid-3">
                    {% for link in social_links %}
                    <a href="{{ link.url }}" target="_blank" class="social-link-card">
                        <strong>{{ link.platform }}</strong>
                        <br>@{{ link.username }}
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <p style="color: var(--gray); text-align: center; padding: 2rem;">
                    Este usuario no ha compartido sus redes sociales
                </p>
            {% endif %}
        {% endif %}
    </div>
</div>

<style>
.social-link-card {
    display: block;
    padding: 1.5rem;
    background: var(--light);
    border-radius: 10px;
    text-decoration: none;
    color: var(--dark);
    text-align: center;
    transition: all 0.3s;
}

.social-link-card:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-3px);
}

.contact-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid var(--light);
    flex-wrap: wrap;
}

.tab-btn {
    background: transparent;
    border: none;
    padding: 1rem 1.5rem;
    cursor: pointer;
    font-size: 0.95rem;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    color: var(--gray);
    font-weight: 500;
}

.tab-btn:hover {
    background: var(--light);
    color: var(--dark);
}

.tab-btn.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    font-weight: 600;
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tab-content h3 {
    margin-bottom: 1.5rem;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tab-content form {
    max-width: 600px;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--dark);
    font-weight: 500;
}

.form-group input[type="checkbox"] {
    margin-right: 0.5rem;
}

.form-control {
    width: 100%;
    padding: 0.8rem;
    border: 2px solid var(--light);
    border-radius: 5px;
    font-size: 1rem;
    transition: all 0.3s;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
}

/* Social Preview Styles */
.social-preview {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.preview-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.preview-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.preview-avatar-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    border: 3px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.preview-info h4 {
    margin: 0;
    color: var(--dark);
    font-size: 1.2rem;
}

.preview-username {
    margin: 0.25rem 0 0 0;
    color: var(--gray);
    font-size: 0.9rem;
}

.preview-bio {
    color: var(--dark);
    line-height: 1.5;
    margin: 1rem 0;
    font-size: 0.95rem;
}

.preview-followers {
    color: var(--gray);
    font-size: 0.9rem;
    margin: 0.5rem 0;
}

.preview-link {
    display: inline-block;
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    margin-top: 0.5rem;
    transition: all 0.3s;
}

.preview-link:hover {
    color: var(--primary-dark);
    transform: translateX(3px);
}

.form-group small {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.85rem;
}
</style>

<script>
function copyCode() {
    const code = "{{ user.friend_code }}";
    navigator.clipboard.writeText(code).then(() => {
        alert('‚úÖ C√≥digo copiado: ' + code);
    }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = code;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('‚úÖ C√≥digo copiado: ' + code);
    });
}

function switchTab(platform) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    document.querySelector(`[data-platform="${platform}"]`).classList.add('active');
    document.getElementById(`tab-${platform}`).classList.add('active');
}
</script>
{% endblock %}
